import os
import requests

AOC_LEADERBOARD_ID = os.getenv("AOC_SLACK_LEADERBOARD_ID")
AOC_SESSION = os.getenv("AOC_SLACK_SESSION")

AOC_URL = f"https://adventofcode.com/2025/leaderboard/private/view/{AOC_LEADERBOARD_ID}.json"
HEADERS = {
    "Cookie": f"session={AOC_SESSION}",
    "User-Agent": "noud.savenije@cinqict.nl"
}

def fetch_leaderboard():
    resp = requests.get(AOC_URL, headers=HEADERS)
    resp.raise_for_status()
    return resp.json()
    # return {'num_days': 12, 'event': '2025', 'day1_ts': 1764565200, 'owner_id': 4323660, 'members': {'5148214': {'local_score': 19, 'name': 'Sven Rohde', 'stars': 2, 'id': 5148214, 'completion_day_level': {'1': {'2': {'star_index': 12, 'get_star_ts': 1764584448}, '1': {'star_index': 11, 'get_star_ts': 1764583488}}}, 'last_star_ts': 1764584448}, '211133': {'completion_day_level': {}, 'last_star_ts': 0, 'local_score': 0, 'name': 'Willem Romijn', 'stars': 0, 'id': 211133}, '1879116': {'last_star_ts': 1764574871, 'completion_day_level': {'1': {'2': {'star_index': 4, 'get_star_ts': 1764574871}, '1': {'get_star_ts': 1764574831, 'star_index': 3}}}, 'stars': 2, 'id': 1879116, 'name': 'mortenzwarenstein', 'local_score': 27}, '728527': {'last_star_ts': 0, 'completion_day_level': {}, 'stars': 0, 'id': 728527, 'name': 'Dirc', 'local_score': 0}, '5157483': {'completion_day_level': {}, 'last_star_ts': 0, 'local_score': 0, 'name': 'Eelco', 'id': 5157483, 'stars': 0}, '5183913': {'stars': 2, 'id': 5183913, 'name': 'Bart van Dijk', 'local_score': 18, 'last_star_ts': 1764586936, 'completion_day_level': {'1': {'1': {'star_index': 10, 'get_star_ts': 1764582052}, '2': {'star_index': 14, 'get_star_ts': 1764586936}}}}, '4323660': {'stars': 2, 'id': 4323660, 'name': 'NSavenije', 'local_score': 30, 'last_star_ts': 1764567057, 'completion_day_level': {'1': {'2': {'get_star_ts': 1764567057, 'star_index': 1}, '1': {'star_index': 0, 'get_star_ts': 1764565590}}}}, '5166344': {'local_score': 10, 'name': 'Erik Oeynhausen', 'id': 5166344, 'stars': 1, 'completion_day_level': {'1': {'1': {'get_star_ts': 1764578083, 'star_index': 7}}}, 'last_star_ts': 1764578083}, '2487748': {'completion_day_level': {'1': {'1': {'star_index': 6, 'get_star_ts': 1764577572}}}, 'last_star_ts': 1764577572, 'local_score': 11, 'name': 'sdehaan1992', 'stars': 1, 'id': 2487748}, '5155825': {'completion_day_level': {}, 'last_star_ts': 0, 'local_score': 0, 'name': 'Dion Simon', 'stars': 0, 'id': 5155825}, '5141908': {'local_score': 25, 'name': 'Stefan Koppelaar', 'id': 5141908, 'stars': 2, 'completion_day_level': {'1': {'2': {'star_index': 8, 'get_star_ts': 1764578443}, '1': {'star_index': 5, 'get_star_ts': 1764575435}}}, 'last_star_ts': 1764578443}, '1015031': {'name': 'Jeannette Mossel', 'id': 1015031, 'stars': 0, 'local_score': 0, 'last_star_ts': 0, 'completion_day_level': {}}, '1810933': {'last_star_ts': 0, 'completion_day_level': {}, 'stars': 0, 'id': 1810933, 'name': 'BoukeNijhuis', 'local_score': 0}, '3251895': {'completion_day_level': {'1': {'1': {'get_star_ts': 1764574016, 'star_index': 2}, '2': {'star_index': 13, 'get_star_ts': 1764584686}}}, 'last_star_ts': 1764584686, 'local_score': 25, 'name': 'Quinten Stekelenburg', 'id': 3251895, 'stars': 2}, '5224501': {'local_score': 18, 'stars': 2, 'id': 5224501, 'name': 'BasBakkenes', 'completion_day_level': {'1': {'1': {'get_star_ts': 1764581182, 'star_index': 9}, '2': {'star_index': 15, 'get_star_ts': 1764587074}}}, 'last_star_ts': 1764587074}}}
    # return {'members': {'1810933': {'completion_day_level': {}, 'stars': 0, 'name': 'BoukeNijhuis', 'id': 1810933, 'local_score': 0, 'last_star_ts': 0}, '5148214': {'last_star_ts': 1764584448, 'id': 5148214, 'local_score': 19, 'completion_day_level': {'1': {'1': {'get_star_ts': 1764583488, 'star_index': 11}, '2': {'get_star_ts': 1764584448, 'star_index': 12}}}, 'name': 'Sven Rohde', 'stars': 2}, '1879116': {'last_star_ts': 1764574871, 'id': 1879116, 'local_score': 27, 'completion_day_level': {'1': {'1': {'get_star_ts': 1764574831, 'star_index': 3}, '2': {'get_star_ts': 1764574871, 'star_index': 4}}}, 'stars': 2, 'name': 'mortenzwarenstein'}, '4323660': {'completion_day_level': {'1': {'1': {'star_index': 0, 'get_star_ts': 1764565590}, '2': {'get_star_ts': 1764567057, 'star_index': 1}}}, 'name': 'NSavenije', 'stars': 2, 'local_score': 30, 'id': 4323660, 'last_star_ts': 1764567057}, '5166344': {'last_star_ts': 1764578083, 'completion_day_level': {'1': {'1': {'get_star_ts': 1764578083, 'star_index': 7}}}, 'name': 'Erik Oeynhausen', 'stars': 1, 'id': 5166344, 'local_score': 10}, '2487748': {'last_star_ts': 1764577572, 'name': 'sdehaan1992', 'completion_day_level': {'1': {'1': {'star_index': 6, 'get_star_ts': 1764577572}}}, 'stars': 1, 'local_score': 11, 'id': 2487748}, '5224501': {'last_star_ts': 1764587074, 'local_score': 18, 'id': 5224501, 'stars': 2, 'completion_day_level': {'1': {'2': {'star_index': 15, 'get_star_ts': 1764587074}, '1': {'star_index': 9, 'get_star_ts': 1764581182}}}, 'name': 'BasBakkenes'}, '211133': {'last_star_ts': 0, 'local_score': 0, 'id': 211133, 'name': 'Willem Romijn', 'completion_day_level': {}, 'stars': 0}, '5183913': {'stars': 2, 'completion_day_level': {'1': {'1': {'star_index': 10, 'get_star_ts': 1764582052}, '2': {'get_star_ts': 1764586936, 'star_index': 14}}}, 'name': 'Bart van Dijk', 'id': 5183913, 'local_score': 18, 'last_star_ts': 1764586936}, '5155825': {'last_star_ts': 1764597428, 'completion_day_level': {'1': {'1': {'star_index': 16, 'get_star_ts': 1764597428}}}, 'stars': 1, 'name': 'Dion Simon', 'id': 5155825, 'local_score': 6}, '1015031': {'stars': 0, 'completion_day_level': {}, 'name': 'Jeannette Mossel', 'id': 1015031, 'local_score': 0, 'last_star_ts': 0}, '5157483': {'local_score': 0, 'id': 5157483, 'name': 'Eelco', 'completion_day_level': {}, 'stars': 0, 'last_star_ts': 0}, '5141908': {'completion_day_level': {'1': {'2': {'star_index': 8, 'get_star_ts': 1764578443}, '1': {'get_star_ts': 1764575435, 'star_index': 5}}}, 'name': 'Stefan Koppelaar', 'stars': 2, 'local_score': 25, 'id': 5141908, 'last_star_ts': 1764578443}, '3251895': {'local_score': 25, 'id': 3251895, 'stars': 2, 'completion_day_level': {'1': {'2': {'get_star_ts': 1764584686, 'star_index': 13}, '1': {'get_star_ts': 1764574016, 'star_index': 2}}}, 'name': 'Quinten Stekelenburg', 'last_star_ts': 1764584686}, '728527': {'last_star_ts': 0, 'id': 728527, 'local_score': 0, 'completion_day_level': {}, 'name': 'Dirc', 'stars': 0}}, 'event': '2025', 'num_days': 12, 'owner_id': 4323660, 'day1_ts': 1764565200}
